echo "Running pre-push checks..."
echo ""

# 1. Lint Cypress specs for best practices
echo "Step 1/3: Checking Cypress best practices..."
bash scripts/lint-cypress.sh
echo ""

# 2. Build and run E2E tests
echo "Step 2/3: Building and running E2E tests..."
npm run build
npm run test:e2e
echo ""

# 3. Run mutation testing only when new spec files are created (not on edits)
NEW_SPECS=$(git diff --diff-filter=A --name-only @{push}.. -- 'cypress/e2e/*.cy.ts' 2>/dev/null || git diff --diff-filter=A --name-only HEAD~1 -- 'cypress/e2e/*.cy.ts' 2>/dev/null || true)

if [ -n "$NEW_SPECS" ]; then
  echo "Step 3/3: Running mutation testing (new test files detected)..."
  echo "New specs: $NEW_SPECS"
  npm run test:mutate
else
  echo "Step 3/3: Skipping mutation testing (no new test files)"
fi

echo ""
echo "All pre-push checks passed"
